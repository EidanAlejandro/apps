{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CIM - Gestión Municipal{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    {# --- Estilos del base.html anterior (Figma) --- #}
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { background-color: #ffffff; height: 100vh; position: fixed; top: 0; left: 0; border-right: 1px solid #dee2e6; width: 260px; z-index: 100; padding-top: 1rem; }
        .sidebar .nav-link { color: #495057; padding: 0.65rem 1.5rem; font-size: 0.95rem; display: flex; align-items: center; border-left: 3px solid transparent; }
        .sidebar .nav-link i { margin-right: 0.8rem; width: 1.2em; font-size: 1.1em; }
        .sidebar .nav-link:hover { color: #0d6efd; background-color: #eef2f7; border-left-color: #cfe2ff; }
        .sidebar .nav-link.active { color: #0d6efd; font-weight: 500; background-color: #eef2f7; border-left-color: #0d6efd; }
        .main-content { margin-left: 260px; padding: 1.5rem; padding-top: 76px; /* Aumentado para header más alto */ }
        .header-simple { background-color: #ffffff; border-bottom: 1px solid #dee2e6; padding: 0.75rem 1.5rem; position: fixed; top: 0; left: 260px; right: 0; z-index: 101; height: 70px; /* Header un poco más alto */ }
        .summary-card { border: none; border-radius: 0.5rem; padding: 1.25rem; margin-bottom: 1rem; color: #555; /* Texto más oscuro */ }
        .summary-card .h1 { font-size: 1.8rem; font-weight: bold; margin-top: 0.5rem; }
        .card-stat-blue { background-color: #e7f1ff; border-left: 4px solid #0d6efd; }
        .card-stat-blue .h1 { color: #0d6efd; }
        .card-stat-green { background-color: #e0f8e9; border-left: 4px solid #198754; }
        .card-stat-green .h1 { color: #198754; }
        .card-stat-purple { background-color: #f3e8ff; border-left: 4px solid #6f42c1; }
        .card-stat-purple .h1 { color: #6f42c1; }
        .card-stat-yellow { background-color: #fff8e1; border-left: 4px solid #ffc107; }
        .card-stat-yellow .h1 { color: #b8860b; } /* Amarillo más oscuro */
        .card-stat-red { background-color: #ffebe5; border-left: 4px solid #dc3545; }
        .card-stat-red .h1 { color: #dc3545; }
        .list-card { background-color: #ffffff; border-radius: 0.5rem; padding: 1.5rem; box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,.075); border: 1px solid #dee2e6;}
        .table th { font-weight: 500; color: #6c757d; font-size: 0.85rem; text-transform: uppercase; border-bottom-width: 1px; }
        .table td { vertical-align: middle; font-size: 0.9rem; }
        .badge { font-weight: 500; padding: 0.35em 0.65em; font-size: 0.75em; }
        .badge.bg-success-light { background-color: #d1e7dd !important; color: #0f5132 !important; }
        .badge.bg-warning-light { background-color: #fff3cd !important; color: #664d03 !important; }
        .badge.bg-danger-light { background-color: #f8d7da !important; color: #842029 !important; }
        .badge.bg-info-light { background-color: #cff4fc !important; color: #055160 !important; }
        .badge.bg-purple-light { background-color: #f3e8ff !important; color: #6f42c1 !important; } /* Para "En Proceso" */
        .btn-accion i { font-size: 1.1em; }
        .search-input { background-color: #f1f3f5; border: none; }
        .filter-btn { color: #6c757d; }
        .dropdown-menu { font-size: 0.9rem; }
        .dropdown-item { padding: 0.5rem 1rem; }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebar" class="col-md-3 col-lg-2 d-none d-md-block sidebar">
                 <div class="position-sticky">
                    {# Logo/Título en Sidebar #}
                    <a href="{% url 'main_admin' %}" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none px-3">
                         <i class="bi bi-buildings-fill fs-4 me-2 text-primary"></i>
                        <span class="fs-5 fw-bold">CIM</span>
                    </a>
                    <hr class="mt-2 mb-3">
                    {# Menú de Navegación #}
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'main_admin' %}active{% endif %}" href="{% url 'main_admin' %}"><i class="bi bi-speedometer2"></i> Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.app_name == 'users' and 'cuadrilla' not in request.path %}active{% endif %}" href="{% url 'user_list' %}"><i class="bi bi-people-fill"></i> Usuarios</a>
                        </li>
                         <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.app_name == 'organization' and 'direccion' in request.path %}active{% endif %}" href="{% url 'main_direccion' %}"><i class="bi bi-building"></i> Direcciones</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.app_name == 'organization' and 'departamento' in request.path %}active{% endif %}" href="{% url 'main_departamento' %}"><i class="bi bi-diagram-3"></i> Departamentos</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.app_name == 'requests' %}active{% endif %}" href="{% url 'main_requests' %}"><i class="bi bi-flag-fill"></i> Incidencias</a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.app_name == 'surveys' %}active{% endif %}" href="{% url 'main_encuesta' %}"><i class="bi bi-clipboard-check"></i> Encuestas</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.app_name == 'surveys' %}active{% endif %}" href="{% url 'cuadrilla_list' %}"><i class="bi bi-person-workspace"></i> Cuadrilla</a>
                        </li>
                    </ul>

                     <div style="position: absolute; bottom: -9rem; width: calc(100% - 2rem);">
                         <hr>
                         <ul class="nav flex-column">
                              <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'profile_edit' %}active{% endif %}" href="{% url 'profile_edit' %}"><i class="bi bi-person-circle"></i> Mi Perfil</a>
                             </li>
                             <li class="nav-item">
                                <form action="{% url 'logout' %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="nav-link" style="background:none; border:none; width:100%; text-align: left;">
                                        <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
                                    </button>
                                </form>
                             </li>
                         </ul>
                     </div>
                </div>
            </nav>

            <div class="main-content col-md-9 ms-sm-auto col-lg-10">
                <header class="d-flex justify-content-end align-items-center header-simple">
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="badge bg-secondary rounded-circle me-2 px-1 py-1"><i class="bi bi-person-fill text-white"></i></span>
                            <span class="d-none d-sm-inline">{{ request.user.get_full_name|default:request.user.username }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end text-small shadow" aria-labelledby="dropdownUser1">
                            <li><a class="dropdown-item" href="{% url 'profile_edit' %}">Editar Perfil</a></li>
                            <li><a class="dropdown-item" href="{% url 'password_change' %}">Cambiar Contraseña</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form action="{% url 'logout' %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item">Cerrar Sesión</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </header>

                <main>
                    {# Mostrar mensajes globales #}
                    {% if messages %}
                        <div class="mb-3">
                        {% for message in messages %}
                            <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} alert-dismissible fade show small py-2" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close py-2" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                        </div>
                    {% endif %}

                    {% block content %}
  
                    <h2>Bienvenido</h2>
                    <p>Selecciona una opción del menú.</p>
                    {% endblock %}


                    <footer class="pt-4 my-md-5 pt-md-5 border-top">
                        <div class="row">
                            <div class="col-12 text-center">
                                <small class="d-block mb-3 text-muted">© {% now "Y" %}  Proyecto CIM</small>
                            </div>
                        </div>
                    </footer>
                </main>

            </div> </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>